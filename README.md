

![1CTelegram](https://github.com/Bayselonarrend/TelegramEnterprise/raw/main/logo_small.png)
# TelegramEnterprise
Библиотека интеграции 1С и Telegram

В данной библиотеке реализованы базовые методы Telegram Bot API для управления ботами  

**Особенности:**
- Не нужно ничего устанавливать: создайте 2 пустых модуля в базе и скопируйте код из репозитория туда
- Не нужно разбираться в документации Telegram Bot API: методы уже выполняют конкретные действия, которые подойдут большинству пользователей, вроде ОтправитьКартинку() или ПереслатьСообщение()
- Основная разработка с тестированием велись на режиме своместимости версии 8.3.6. Возможно, будет работать и на более ранних версиях.

Документация Telegram Bot API: <br>
[https://core.telegram.org/bots/api](https://core.telegram.org/bots/api)

Схожая библиотека, но для VK:<br>
[https://github.com/Bayselonarrend/VKEnterprise](https://github.com/Bayselonarrend/VKEnterprise)



## Для начала использования библиотеки достаточно пройти два простых шага: ##
<details>
<summary>Установка библиотеки</summary>
<br>
Библиотека представляет из себя всего два общих модуля
 
- **Инструменты** (Tools.bsl) - содержит вспомогательные методы, вроде отправки http запросов, чтения JSON и пр.
- **Действия** (Actions.bsl)   - непосредственно сами методы работы с Telegram
  
Эти модули необходимо добавить в свою конфигурацию (модули серверные). При переименовании модуля **Инструменты** необходимо будет провести рефакторинг в модуле **Действия**. Модуль же **Действия** можно переименовывать без изменений. 

Если вы уже используете библиотеку [VKEnterprise](https://github.com/Bayselonarrend/VKEnterprise) для интеграции с ВКонтакте, то модуль Инструменты совместим и дублировать его не нужно, однако стоит проверить, не изменилось ли что-нибудь с выходами новых версий библиотек.

После установки можно вызывать нужные методы из модуля **Действия**
</details>

<details>
<summary>Получение необходимых данных</summary>
<br>
	
Перед началом работы необходимо получить некоторые параметры для бота Telegram. Их всего два

**1. Токен**
   
   Токен можно получить у [BotFather]([https://core.telegram.org/bots/api](https://t.me/BotFather)) сразу после создания бота

**2. ID чата**

   Если вы собираетесь использовать бота для управления каналом, то вместо ID чата можно использовать имя с @ в начале (@mychannel). При использовании бота как чат-бота, ID чата необходимо получать из сообщений, приходящих на ваш http-сервис, для каждого отдельного пользователя.

  Оба эти значения передаются как первые два параметра в методы.
  
</details>

## Реализованные методы: ##
*Все методы возвращают ответ от Telegram как структуру*

<details>
  
<summary>Для получения данных бота</summary>
<br>
Эти методы предназначены для получения данных бота

* __Информация о боте | Метод: ПолучитьИнформациюБота()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |

___

* __Получение обновлений при работе в режиме LongPoll | Метод: ПолучитьОбновления()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |

*LongPoll - вы сами получаете обновления о новых сообщениях от Telegram. Callback - сервер присылает вам информацию при появлении новых сообщений.*
___

* __Обработать Callback от бота | Метод: ОбработатьДанные()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Запрос | Http-запрос | Запрос, приходящий на http-сервис |

*Преобразует запрос от бота в человеческий вид. Возвращает структуру*
___

</details>


<details>
  
<summary>Для работы в чатах и каналах</summary>
<br>
Эти методы предназначены для отправки разнообразных сообщений в чаты и каналы

* __Отправить текстовое сообщение | Метод: ОтправитьТекстовоеСообщение()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | Текст | Строка | Текст сообщения |
  | Клавиатура | Строка | См. Прочее - Сформировать клавиатуру по массиву кнопок |

___


* __Отправить картинку | Метод: ОтправитьКартинку()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | Текст | Строка | Подпись под картинкой |
  | Картинка | Двоичные данные / Строка (путь к файлу) | Файл |
  | Клавиатура | Строка | См. Прочее - Сформировать клавиатуру по массиву кнопок |

___


* __Отправить видео | Метод: ОтправитьВидео()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | Текст | Строка | Подпись под видео |
  | Видео | Двоичные данные / Строка (путь к файлу) | Файл |
  | Клавиатура | Строка | См. Прочее - Сформировать клавиатуру по массиву кнопок |

___


* __Отправить аудио | Метод: ОтправитьАудио()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | Текст | Строка | Подпись под аудио |
  | Аудио | Двоичные данные / Строка (путь к файлу) | Файл |
  | Клавиатура | Строка | См. Прочее - Сформировать клавиатуру по массиву кнопок |

___


* __Отправить документ | Метод: ОтправитьДокумент()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | Текст | Строка | Подпись под документом |
  | Документ | Двоичные данные / Строка (путь к файлу) | Файл |
  | Клавиатура | Строка | См. Прочее - Сформировать клавиатуру по массиву кнопок |

___

* __Отправить гифку | Метод: ОтправитьГифку()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | Текст | Строка | Подпись под гифкой |
  | Гифка | Двоичные данные / Строка (путь к файлу) | Файл |
  | Клавиатура | Строка | См. Прочее - Сформировать клавиатуру по массиву кнопок |

___

* __Отправить набор любых файлов | Метод: ОтправитьНаборЛюбыхФайлов()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | Текст | Строка | Подпись под файлами |
  | СоответствиеФайлов | Соответствие: Ключ - ДД, Строка (Путь к файлу); Значение - Тип содержимого | Набор файлов |
  | Клавиатура | Строка | См. Прочее - Сформировать клавиатуру по массиву кнопок |

*Доступны типы файлов: audio, document, photo, video. Нельяз смешивать типы audio и document с другими типами внутри одного сообщения.*
___


* __Отправить местоположение | Метод: ОтправитьМестоположение()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | Широта | Строка/Число | Географическая широта |
  | Долгота | Строка/Число | Географическая долгота |
  | Клавиатура | Строка | См. Прочее - Сформировать клавиатуру по массиву кнопок |

___


* __Отправить контакт с номером телефона | Метод: ОтправитьКонтакт()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | Имя | Строка/Число | Имя |
  | Фамилия | Строка/Число | Фамилия |
  | Телефон | Строка | Номер телефона |

___


* __Отправить опрос | Метод: ОтправитьОпрос()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | Вопрос | Строка | Вопрос опроса |
  | Массив ответов | Массив строк | Строки варианты ответа |
  | Анонимный | Булево (по умолчанию Истина) | Анонимность опроса |

___


* __Переслать сообщение | Метод: ПереслатьСообщение()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDОригинала | Строка/Число | ID сообщения в чате-источнике |
  | IDОткуда | Строка/Число | ID чата-источника |
  | IDКуда | Строка/Число | ID чата-приемника |

___

</details>



<details>
  
<summary>Для администрирования канала</summary>
<br>
Эти методы предназначены для администрирования каналов


* __Забанить пользователя | Метод: Бан()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | IDПользователя | Строка/Число | ID участника канала |
___


* __Разбанить пользователя | Метод: Разбан()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | IDПользователя | Строка/Число | ID участника канала |
___


* __Создать ссылку-приглашение | Метод: СоздатьСсылкуПриглашение()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | Заголовок | Строка (по умолчанию "") | Заголовок ссылки |
  | Дата истечения | Дата (по умолчанию "") | Дата, после которой ссылка становится неактивной. Бессрочная, если не заполнено |
  | ЛимитПользователей | Число (по умолчанию "") | Максимальное количество вступлений по ссылке. Бесконечно, если не заполнено |
___


* __Закрепить сообщение | Метод: ЗакрепитьСообщение()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | IDСообщения | Строка/Число | ID сообщения для закрепления |
___


* __Открепить сообщение | Метод: ОткрепитьСообщение()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | IDСообщения | Строка/Число | ID сообщения для открепления |
___

* __Получить число участников канала | Метод: ПолучитьЧислоУчастников()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
___

</details>


<details>
  
<summary>Прочее</summary>
<br>
Прочие методы

* __Создать клавиатуру из массива кнопок | Метод: Сформировать клавиатуру по массиву кнопок()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Массив кнопок | Массив строк | Массив строк с текстом кнопок |
  | Под сообщением | Булево (по умолчанию Ложь) | Истина - кнопки будут под сообщением (доступно не для всех методов), Ложь - кнопки будут нижней панелью над полем ввода сообщения |
___

* __Отправить любой файл (метод используется как основа для функций отправки картинки, видео, документа, аудио и гифки) | Метод: ОтправитьФайл()__
  
  | Параметр | Тип | Назначение |
  |-|-|-|
  | Токен | Строка | Токен бота |
  | IDЧата | Строка/Число | ID целевого чата |
  | Текст | Строка | Текст сообщения |
  | Файл | Двоичные данные / Строка (путь к файлу) | Файл |
  | Вид | Строка | Доступные значения: document, photo, video, audio, animation |
  | Клавиатура | Строка | См. Прочее - Сформировать клавиатуру по массиву кнопок |
  
</details>

___

>В проекте используется механизм распаковки zip и gzip vbondarevsky/Connector
>
>Copyright 2017-2023 Vladimir Bondarevskiy
>под Apache License, Version 2.0
>
>[https://github.com/vbondarevsky/Connector/](https://github.com/vbondarevsky/Connector/)
>
>Остальной проект распространяется под лицензией MIT
>
>Модуль Инструменты данной библиотеки совместим с подобным модулем библиотеки VKEnterprise для интеграции с ВКонтакте<br><br>
>[https://github.com/Bayselonarrend/VKEnterprise](https://github.com/Bayselonarrend/VKEnterprise)

<br>

>![Infostart](https://github.com/Bayselonarrend/TelegramEnterprise/raw/main/infostart.svg)
>
>Статья на Инфостарте: [https://infostart.ru/1c/articles/1951756/](https://infostart.ru/1c/articles/1951756/)
